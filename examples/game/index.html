<!DOCTYPE HTML>

<!--
/*
* ES6 Defender
*
* Copyright (C) 2017  Mark Purser
* Released under the MIT license
* http://github.com/markpurser/es6-defender/LICENSE
*/
-->

<html>
<head>
    <meta charset="UTF-8">
    <title>ES6 Defender</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
        #render-canvas { border:1px solid #ccc }
    </style>

</head>
<body onload="init();">
    <canvas id="render-canvas"></canvas>

    <script src="js/vendor/pixi-4.4.1.min.js"></script>
    <script src="js/vendor/input.js"></script>
    <script src="js/es6-defender.min.js"></script>

    <script>
        function init()
        {
            var viewWidth = 128, viewHeight = 96;

            var fastTextMode = new FastTextMode;
            fastTextMode.init({
                renderCanvas: document.getElementById("render-canvas"),
                renderCanvasSize: {width: 1100, height: 900},
                viewWidth: viewWidth,
                viewHeight: viewHeight
            })
            .then(function() {
                keyboard = new Keyboard();
                playerX = 0;
                playerY = 0;
                t = 0;

                var spaceLatch = 0;

                function animate()
                {
                    var input = {updown: 0, leftright: 0, fire: 0};

                    if(keyboard.isKeyPressed(Keyboard.KEYS.UP))
                    {
                        input.updown = -1;
                    }

                    if(keyboard.isKeyPressed(Keyboard.KEYS.DOWN))
                    {
                        input.updown = 1;
                    }

                    if(keyboard.isKeyPressed(Keyboard.KEYS.LEFT))
                    {
                        input.leftright = -1;
                    }

                    if(keyboard.isKeyPressed(Keyboard.KEYS.RIGHT))
                    {
                        input.leftright = 1;
                    }

                    if(spaceLatch == 1)
                    {
                        if(!keyboard.isKeyPressed(Keyboard.KEYS.SPACE)) spaceLatch = 0;
                    }

                    if(keyboard.isKeyPressed(Keyboard.KEYS.SPACE) && spaceLatch == 0)
                    {
                        input.fire = 1;
                        spaceLatch = 1;
                    }

                    doGame(fastTextMode, viewWidth, viewHeight, input, t++, false);

                    fastTextMode.render();

                    requestAnimationFrame(animate);
                }

                requestAnimationFrame(animate);
            });
        }
    </script>

</body>
</html>
