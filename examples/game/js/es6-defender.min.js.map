{"version":3,"sources":["retrovision.js"],"names":["RetroVision","options","_this","Object","keys","defaults","forEach","key","_options","Promise","resolve","reject","_parentContainer","PIXI","Container","_tileTextures","pixiOptions","clearBeforeRender","preserveDrawingBuffer","resolution","view","renderCanvas","_renderer","autoDetectRenderer","renderCanvasSize","width","height","backgroundColor","_stats","fpsText","Text","font","fill","fpsTimer","currentFrameCount","loader","add","tilesheetImage","load","resources","numTilesX","tilesheet","texture","tileWidthPx","numTilesY","tileHeightPx","x","y","rect","Rectangle","Texture","_worldSpriteContainer","SpriteGrid","viewWidth","viewHeight","codePointAt","addChild","getSpriteContainer","displayStats","updateStats","render","sprites","getSprites","index","tileCode","colour","flash","Math","floor","random","tint","tileString","X","c","length","set","number","setString","toString","stats","Date","getTime","rendererTypeStr","WebGLRenderer","text","VERSION","gridWidth","gridHeight","tileTexture","spriteContainer","sprite","Sprite","position"],"mappings":"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","file":"es6-defender.min.js","sourcesContent":["/*\n* retrovision.js\n*\n* Copyright (C) 2016  Mark Purser\n* Released under the MIT license\n* http://github.com/markpurser/retrovision/LICENSE\n*\n* Tile rendering based on\n* https://github.com/jice-nospam/yendor.ts\n* Copyright (c) 2014 Jice\n*/\n\nclass RetroVision {\n\n    init(options) {\n        var _this = this;\n\n        options = options || {};\n        Object.keys( RetroVision.defaults ).forEach( function( key ) {\n            if (!(key in options)) options[ key ] = RetroVision.defaults[ key ];\n        });\n\n        _this._options = options;\n\n        return new Promise(function(resolve, reject) {\n            // create a new instance of a pixi container\n            _this._parentContainer = new PIXI.Container();\n\n            _this._tileTextures = [];\n\n            // create a renderer instance\n            var pixiOptions = {\n                clearBeforeRender: true,\n                preserveDrawingBuffer: false,\n                resolution: 1,\n                view: options.renderCanvas\n            };\n\n            _this._renderer = PIXI.autoDetectRenderer(\n                options.renderCanvasSize.width, options.renderCanvasSize.height, pixiOptions);\n            _this._renderer.backgroundColor = 0x0;\n\n            _this._stats = {\n                fpsText: new PIXI.Text('', {font: '24px Arial', fill: 0xff1010}),\n                fpsTimer: 0,\n                currentFrameCount: 0\n            };\n\n\n            var loader = PIXI.loader;\n            loader.add('tilesheet', options.tilesheetImage);\n\n            loader.load( function( loader, resources )\n            {\n                var numTilesX = resources.tilesheet.texture.width / options.tileWidthPx;\n                var numTilesY = resources.tilesheet.texture.height / options.tileHeightPx;\n\n                // init tile textures\n                for(var x = 0; x < numTilesX; x++)\n                {\n                    for(var y = 0; y < numTilesY; y++)\n                    {\n                        var rect = new PIXI.Rectangle(x * options.tileWidthPx, y * options.tileHeightPx, options.tileWidthPx, options.tileHeightPx);\n                        _this._tileTextures[x + y * numTilesX] = new PIXI.Texture(resources.tilesheet.texture, rect);\n                    }\n                }\n\n                _this._worldSpriteContainer = new SpriteGrid(\n                    options.viewWidth, options.viewHeight, options.tileWidthPx, options.tileHeightPx, _this._tileTextures[' '.codePointAt(0)]);\n\n                _this._parentContainer.addChild(_this._worldSpriteContainer.getSpriteContainer());\n                _this._parentContainer.addChild(_this._stats.fpsText);\n\n                resolve();\n            });\n        });\n    }\n\n    render() {\n        if(this._options.displayStats)\n        {\n            this.updateStats(this._stats);\n        }\n\n        // render\n        this._renderer.render(this._parentContainer);\n\n        // clear screen\n        var sprites = this._worldSpriteContainer.getSprites();\n        for(var x = 0; x < this._options.viewWidth; x++)\n        {\n            for(var y = 0; y < this._options.viewHeight; y++)\n            {\n                var index = x + y * this._options.viewWidth;\n                sprites[index].texture = this._tileTextures[32];\n            }\n        }\n    }\n\n    set(x, y, tileCode, colour = 0xffffff) {\n        if(x < 0 || x >= this._options.viewWidth || y < 0 || y >= this._options.viewHeight) return;\n\n        if(typeof(tileCode) === 'string')\n        {\n            tileCode = tileCode.codePointAt(0);\n        }\n        var index = x + y * this._options.viewWidth;\n        this._worldSpriteContainer.getSprites()[index].texture = this._tileTextures[tileCode];\n\n        if( colour == RetroVision.flash) colour = Math.floor(Math.random() * 0xffffff);\n        this._worldSpriteContainer.getSprites()[index].tint = colour;\n    }\n\n    setString(x, y, tileString, colour = 0xffffff) {\n        var X = x;\n        for(var c = 0; c < tileString.length; c++) {\n            var tileCode = tileString.codePointAt(c);\n            if(tileCode == 10) {\n                y++;\n                x = X;\n            }\n            else {\n                this.set(x, y, tileCode, colour);\n                x++;\n            }\n        }\n    }\n\n    setNumber(x, y, number, colour = 0xffffff) {\n        this.setString(x, y, number.toString(), colour);\n    }\n\n    updateStats(stats) {\n        stats.currentFrameCount++;\n        if( stats.fpsTimer === 0 )\n        {\n            stats.fpsTimer = new Date().getTime();\n        }\n        else if( new Date().getTime() - stats.fpsTimer > 1000 )\n        {\n            var rendererTypeStr = 'Canvas';\n            if(this._renderer instanceof PIXI.WebGLRenderer)\n            {\n                rendererTypeStr = 'WebGL';\n            }\n            stats.fpsText.text = 'fps: ' + stats.currentFrameCount + '\\npixi: ' + PIXI.VERSION + '\\nRenderer: ' + rendererTypeStr;\n            stats.fpsTimer = new Date().getTime();\n            stats.currentFrameCount = 0;\n        }\n    }\n}\n\nRetroVision.defaults = {\n    renderCanvasSize: {width: 1600, height: 900},\n    tilesheetImage: \"assets/terminal.png\",\n    tileWidthPx: 8,\n    tileHeightPx: 8,\n    viewWidth: 128,\n    viewHeight: 128,\n    displayStats: true\n}\n\nRetroVision.flash = -1;\n\nclass SpriteGrid {\n\n    constructor(gridWidth, gridHeight, tileWidthPx, tileHeightPx, tileTexture) {\n\n        this.spriteContainer = new PIXI.Container();\n        this.sprites = [];\n\n        // init grid\n        for(var x = 0; x < gridWidth; x++)\n        {\n            for(var y = 0; y < gridHeight; y++)\n            {\n                var sprite = new PIXI.Sprite(tileTexture);\n                sprite.position.x = x * tileWidthPx;\n                sprite.position.y = y * tileHeightPx;\n                sprite.width = tileWidthPx;\n                sprite.height = tileHeightPx;\n                this.sprites[x + y * gridWidth] = sprite;\n                this.spriteContainer.addChild(sprite);\n            }\n        }\n    }\n\n    getSpriteContainer() {\n        return this.spriteContainer;\n    }\n\n    getSprites() {\n        return this.sprites;\n    }\n}\n\n"]}